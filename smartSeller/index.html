<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我是精明的小卖家</title>
    <script src="ife31data.js"></script>
    <style>
        table {
            font-family: verdana, arial, sans-serif;
            font-size: 11px;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }
        
        table th {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #dedede;
        }
        
        table td {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #ffffff;
        }
    </style>
</head>

<body>
    <div id="region-radio-wrapper"></div>
    <div id="product-radio-wrapper"></div>
    <select id="region-select">
            <option>华东</option>
            <option>华南</option>
            <option>华北</option>
        </select>
    <select id="product-select">
                <option>手机</option>
                <option>笔记本</option>
                <option>智能音箱</option>
            </select>
    <div id="table-wrapper"></div>
</body>
<script>
    var regionSelect = document.getElementById('region-select');
    var productSelect = document.getElementById('product-select');
    var tableWrapper = document.getElementById('table-wrapper');
    createCheckBox('region-radio-wrapper', [{
        value: '华东',
        text: '华东'
    }, {
        value: '华南',
        text: '华南'
    }, {
        value: '华北',
        text: '华北'
    }]);
    createCheckBox('product-radio-wrapper', [{
        value: '手机',
        text: '手机'
    }, {
        value: '笔记本',
        text: '笔记本'
    }, {
        value: '智能音箱',
        text: '智能音箱'
    }]);
    regionSelect.onchange = function() {
        generateTable();
    }
    productSelect.onchange = function() {
        generateTable();
    }

    function getData() {
        var newSourceData = [];
        var selectedRegionValue = regionSelect.options[regionSelect.selectedIndex].text;
        var selectedProductValue = productSelect.options[productSelect.selectedIndex].text;
        for (i in sourceData) {
            if (sourceData[i].region == selectedRegionValue && sourceData[i].product == selectedProductValue) {
                newSourceData.push(sourceData[i]);
            }
        }
        return newSourceData;
    }

    function generateTable() {
        var data = getData();
        var str = "<table><thead><th>商品</th><th>地区</th><th>1月</th><th>2月</th><th>3月</th><th>4月</th><th>5月</th><th>6月</th><th>7月</th><th>8月</th><th>9月</th><th>10月</th><th>11月</th><th>12月</th></thead>";
        str += "<tboday>";
        for (i in data) {
            str += "<tr><td>" + data[i].product + "</td><td>" + data[i].region + "</td>";
            for (s in data[i].sale) {
                str += "<td>" + data[i].sale[s] + "</td>";
            }
            str += "</tr>";
            str += "</tboday>"
        }
        tableWrapper.innerHTML = str;
    }

    function createCheckBox(wrapperId, data) {
        var wrapper = document.getElementById(wrapperId);
        var str = '<input type="checkbox" value="all" checkbox-type="all"><span>全选</span>';
        for (i in data) {
            str += '<input type="checkbox" value="' + data[i].value + '">' + data[i].text;
        }
        wrapper.innerHTML = str;
        wrapper.onclick = function(e) {
            var checkboxList = wrapper.getElementsByTagName('input');
            var e = e || window.event;
            var target = e.target || e.srcElement;
            if (target.type == 'checkbox') {
                // var checkboxType = target.getAttribute('checkbox-type');
                if (target.value == 'all') {
                    for (var i = 0; i < checkboxList.length; i++) {
                        checkboxList[i].checked = target.checked;
                    }
                } else {
                    var flag = true;
                    var elementAll;
                    for (var j = 0; j < checkboxList.length; j++) {
                        if (checkboxList[j].value == 'all') {
                            elementAll = checkboxList[j];
                        }
                        if (checkboxList[j].value != 'all' && checkboxList[j].checked != true) {
                            flag = false;
                        }
                    }
                    elementAll.checked = flag;
                }
            }
        }
    }
</script>

</html>